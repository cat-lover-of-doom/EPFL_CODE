cmake_minimum_required(VERSION 3.10)

project(main LANGUAGES CXX)
set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Always export compile_commands.json
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# Collect all source files
file(GLOB SOURCES src/*.cpp)
add_executable(${PROJECT_NAME} ${SOURCES})

# macOS: inject SDK paths
if(APPLE)
  target_compile_options(${PROJECT_NAME} PRIVATE
    -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
    -isystem /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/c++/v1
  )
endif()

# Get the parent directory of the build folder
get_filename_component(BUILD_PARENT_DIR "${CMAKE_BINARY_DIR}" DIRECTORY)

# Always copy compile_commands.json to parent of build
if(CMAKE_EXPORT_COMPILE_COMMANDS)
  add_custom_command(
    TARGET ${PROJECT_NAME} POST_BUILD
    COMMAND ${CMAKE_COMMAND} -E copy_if_different
            "${CMAKE_BINARY_DIR}/compile_commands.json"
            "${BUILD_PARENT_DIR}/compile_commands.json"
    COMMENT "Copying compile_commands.json to ${BUILD_PARENT_DIR}"
  )
endif()
